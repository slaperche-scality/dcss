machine:
  environment:
    CXX: /usr/bin/clang++

dependencies:
  post:
    - wget -O - https://apt.llvm.org/llvm-snapshot.gpg.key|sudo apt-key add -
    - sudo add-apt-repository -y ppa:ubuntu-toolchain-r/test
    - sudo add-apt-repository -y "deb http://apt.llvm.org/trusty/ llvm-toolchain-trusty-5.0 main"
    - sudo apt-get update
    - sudo apt-get -y --no-install-recommends install clang-5.0 clang-tidy-5.0 clang-format-5.0 libargtable2-dev libjsoncpp-dev doxygen libmicrohttpd-dev libedit-dev
    - sudo ln -s /usr/bin/clang-format-5.0 /usr/bin/clang-format
    - sudo ln -s /usr/bin/clang-tidy-5.0 /usr/bin/clang-tidy
    - sudo ln -s /usr/bin/clang++-5.0 /usr/bin/clang++
    - wget https://cmake.org/files/v3.5/cmake-3.5.0-Linux-x86_64.sh
    - sudo sh cmake-3.5.0-Linux-x86_64.sh --prefix=/usr/local --exclude-subdir
    - git clone git://github.com/cinemast/libjson-rpc-cpp.git
    - cd libjson-rpc-cpp && git checkout v0.6.0
    - mkdir libjson-rpc-cpp/build
    - cd libjson-rpc-cpp/build && cmake -DCOMPILE_TESTS=No .. && make && sudo make install
    - sudo ldconfig

compile:
  override:
    - mkdir build && cd build && cmake -G 'Unix Makefiles' .. && make

test:
  override:
    - cd build && make check-format
    - cd build && make check-lint
